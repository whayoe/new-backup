<!-- templates/rekap_opd.html -->
{% extends "layout/base.html" %}

{% block content %}
<div class="container mt-4">
    <h3>ðŸ“Š Rekap Perencanaan per OPD - Tahun {{ tahun }}</h3>

    <!-- Filter Tahun -->
    <form method="get" class="mb-4">
        <label for="tahun">Pilih Tahun: </label>
        <select name="tahun" id="tahun" onchange="this.form.submit()" class="form-select" style="max-width: 200px;">
            {% for year in range(2020, 2031) %}
            <option value="{{ year }}" {% if tahun == year %}selected{% endif %}>{{ year }}</option>
            {% endfor %}
        </select>
    </form>

    <!-- Tabel Rekap -->
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>OPD / Satuan Kerja</th>
                    <th>Jumlah Program</th>
                    <th>Total Pagu Anggaran</th>
                    <th>Terverifikasi</th>
                    <th>Persentase Verifikasi</th>
                </tr>
            </thead>
            <tbody>
                {% for opd, data in rekap.items() %}
                <tr>
                    <td><strong>{{ opd }}</strong></td>
                    <td>{{ data.total_program }}</td>
                    <td><strong>Rp {{ '%.2f' % data.total_pagu }}</strong></td>
                    <td>{{ data.terverifikasi }}</td>
                    <td>
                        <div class="progress">
                            <div class="progress-bar bg-success" role="progressbar"
                                 style="width: {{ data.persentase }}%;"
                                 aria-valuenow="{{ data.persentase }}" aria-valuemin="0" aria-valuemax="100">
                                {{ data.persentase }}%
                            </div>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center">Tidak ada data untuk tahun ini.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Tombol Export -->
    <div class="mt-3">
        <a href="{{ url_for('export_rekap_opd', tahun=tahun) }}" class="btn btn-success">
            ðŸ“¥ Export ke Excel
        </a>
		<a href="{{ url_for('rekap_opd') }}" class="btn btn-outline-info btn-sm">ðŸ“Š Rekap OPD</a>
    </div>
</div>
{% endblock %}